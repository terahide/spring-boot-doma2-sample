<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout}" th:with="menu='home'"><!--/* menuItemにパラメータを渡す */-->
    <head layout:fragment="~{common/layout::header}">
        <title>Home</title>
    </head>
    <body>
        <!--/* この形式のコメントはHTMLソースから削除される */-->
        <div layout:fragment="content">
            <h2>Front Home</h2>
            <div><a th:href="@{/arigato}" id="toArigato" class="glyphicon glyphicon-heart">ありがと</a></div>

            <div id="agigatoContainer">
                <section class="arigato unsetup" th:each="arigato : ${page.data}" th:object="${arigato}">
                    <hr />
                    <dev th:replace="~{arigato/item :: item (${arigato})}" />
                </section>
            </div>
            <div th:if="${page.hasMorePage()}"><hr /><a href="javascript:void(0)" id="more">もっと見る</a></div>
        </div>
        <div layout:fragment="scripts" th:remove="tag">
            <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}" />
            <input
                    type="hidden"
                    id="p"
                    th:value="${page.page}" />
            <script type="text/javascript" th:src="@{/static/js/arigato/eventHandlerSetup.js}"></script>
            <script type="text/javascript">
                $.ajaxSetup({
                    headers: { 'X-XSRF-TOKEN': $('input[name="_csrf"]').val() }
                });
                $().ready(() => {
                    setupHandler();
                    $('#more').on('click', event => {
                        var $this = $(event.currentTarget);
                        $.ajax({
                            url: '/more/' + (parseInt($('#p').val()) + 1),
                            type: 'GET'
                        }).done( (data) => {
                            $('#agigatoContainer').append(data)
                            setupHandler();
                        }).fail( (data) => {
                            alert('error'); //TODO Fake It
                        })
                    });
                });
            </script>
        </div>>
    </body>
</html>
