<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout}" th:with="menu='account'"><!--/* menuItemにパラメータを渡す */-->
<head layout:fragment="~{common/layout::header}">
    <title>Home</title>
</head>
<body>
<!--/* この形式のコメントはHTMLソースから削除される */-->
<div layout:fragment="content">
    <h2>Account</h2>
    <div><a th:href="@{/account/profile}" id="toProfile" class="glyphicon glyphicon-pencil">プロフィール編集</a> <a th:href="@{/account/password}" id="toPassword" class="glyphicon glyphicon-info-sign">パスワード変更</a></div>
    <hr />
    <div><a href="javascript:void(0)" id="fromMeToggle" class="glyphicon glyphicon-comment">私からありがと</a> <a href="javascript:void(0)" id="toMeToggle" class="glyphicon glyphicon-folder-open">あなたからありがと</a></div>
    <div id="fromMe">
        <section class="arigato unsetup" th:each="arigato : ${page_from.data}" th:object="${arigato}">
            <hr />
            <dev th:replace="~{arigato/item :: item (${arigato})}" />
            <div th:if="${page_from.hasMorePage()}"><hr /><a href="javascript:void(0)" id="moreFromMe">もっと見る</a></div>
        </section>
    </div>
    <div id="toMe">
        <section class="arigato unsetup" th:each="arigato : ${page_to.data}" th:object="${arigato}">
            <hr />
            <dev th:replace="~{arigato/item :: item (${arigato})}" />
            <div th:if="${page_to.hasMorePage()}"><hr /><a href="javascript:void(0)" id="moreToMe">もっと見る</a></div>
        </section>
    </div>
</div>
<div layout:fragment="scripts" th:remove="tag">
    <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}" />
    <input
            type="hidden"
            id="fromMeP"
            th:value="${page_from.page}" />
    <input
            type="hidden"
            id="toMeP"
            th:value="${page_to.page}" />
    <script type="text/javascript" th:src="@{/static/js/arigato/eventHandlerSetup.js}"></script>
    <script type="text/javascript">
        $.ajaxSetup({
            headers: { 'X-XSRF-TOKEN': $('input[name="_csrf"]').val() }
        });
        const handleMore = (event, type, $container, p) => {
            var $this = $(event.currentTarget);
            $.ajax({
                url: '/account/more' + type + "/" + (p + 1),
                type: 'GET'
            }).done( (data) => {
                $container.append(data)
                setupHandler();
            }).fail( (data) => {
                alert('error'); //TODO Fake It
            })
        };
        $().ready(() => {
            setupHandler();
            $('#fromMeToggle, #toMeToggle').on('click', event => {
                var $this = $(event.currentTarget)
                console.log(0)
                $('#fromMe, #toMe').toggle()
            })
            $('#toMe').hide();

            $('#moreFromMe').on('click', event => {
                handleMore(event,
                            '/from/me',
                            $('#fromMe'),
                            parseInt($('#fromMeP').val()));
            });
            $('#moreToMe').on('click', event => {
                handleMore(event,
                            '/to/me',
                            $('toMe'),
                            parseInt($('#toMeP').val()));
            });
        });
    </script>
</div>>
</body>
</html>
