<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout}" th:with="menu='account'"><!--/* menuItemにパラメータを渡す */-->
<head layout:fragment="~{common/layout::header}">
    <title>Home</title>
</head>
<body>
<!--/* この形式のコメントはHTMLソースから削除される */-->
<div layout:fragment="content">
    <h2>Account</h2>
    <div><a th:href="@{/account/profile}" id="toProfile" class="glyphicon glyphicon-pencil">プロフィール編集</a> <a th:href="@{/account/password}" id="toPassword" class="glyphicon glyphicon-info-sign">パスワード変更</a></div>
    <hr />
    <div><a href="javascript:void(0)" id="fromMeToggle" class="glyphicon glyphicon-comment">私からありがと</a> <a href="javascript:void(0)" id="toMeToggle" class="glyphicon glyphicon-folder-open">あなたからありがと</a></div>
    <div id="fromMe">
        <section class="arigato" th:each="arigato : ${page_from.data}" th:object="${arigato}">
            <hr />
            to <span><image th:if="*{to.hasImage()}" height="30px" th:src="@{/user/image/__*{to.id}__}" /><span th:text="*{to.name}"></span></span>
            <div th:text="*{subject}" class="subject"></div>
            <div th:text="*{body}"></div>
            <div th:if="*{hasImage()}" ><image width="300px" th:src="@{/arigato/image/__*{firstImageId}__}" /></div>
            from <span><image th:if="*{from.hasImage()}" height="30px" th:src="@{/user/image/__*{from.id}__}" /><span th:text="*{from.name}"></span></span>
            <div class="glyphicon glyphicon-star">いいね！<span class="favCounts" th:text="*{favCounts}">13</span>人 <a href="javascript:void(0)" th:data-id="*{id}" th:class="*{'glyphicon fav ' + (fav ? 'checked glyphicon-thumbs-down' : 'glyphicon-thumbs-up')}">いいね！</a></div>
            <div th:if="*{fromMe}"><a th:href="@{/arigato/__*{id}__}" class="glyphicon glyphicon-pencil">編集</a>&nbsp;<a href="javascript:void(0)" class="delete glyphicon glyphicon-trash" th:data-id="*{id}">削除</a></div>
        </section>
    </div>
    <div id="toMe">
        <section class="arigato" th:each="arigato : ${page_to.data}" th:object="${arigato}">
            <hr />
            to <span><image th:if="*{to.hasImage()}" height="30px" th:src="@{/user/image/__*{to.id}__}" /><span th:text="*{to.name}"></span></span>
            <div th:text="*{subject}" class="subject"></div>
            <div th:text="*{body}"></div>
            <div th:if="*{hasImage()}" ><image width="300px" th:src="@{/arigato/image/__*{firstImageId}__}" /></div>
            from <span><image th:if="*{from.hasImage()}" height="30px" th:src="@{/user/image/__*{from.id}__}" /><span th:text="*{from.name}"></span></span>
            <div class="glyphicon glyphicon-star">いいね！<span class="favCounts" th:text="*{favCounts}">13</span>人 <a href="javascript:void(0)" th:data-id="*{id}" th:class="*{'glyphicon fav ' + (fav ? 'checked glyphicon-thumbs-down' : 'glyphicon-thumbs-up')}">いいね！</a></div>
        </section>
    </div>
</div>
<div layout:fragment="scripts" th:remove="tag">
    <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}" />
    <script type="text/javascript">
        $.ajaxSetup({
            headers: { 'X-XSRF-TOKEN': $('input[name="_csrf"]').val() }
        });
        $().ready(() => {
            $('.fav').on('click', event => {
                var $this = $(event.currentTarget)
                $.ajax({
                    url: '/api/v1/arigato/' + $this.data('id') + '/fav',
                    type: 'PUT',
                    data:{check: ! $this.hasClass('checked')}
                }).done( (data) => {
                    $('.favCounts', $this.parent()).text(data.fav_counts)
                    $this.toggleClass('checked');
                }).fail( (data) => {
                    alert('error'); //TODO Fake It
                })
            });
            $('.arigato .delete').on('click', event => {
                var $this = $(event.currentTarget);
                $.ajax({
                    url: '/api/v1/arigato/' + $this.data('id'),
                    type: 'DELETE'
                }).done( (data) => {
                    $this.parents('.arigato').remove()
                }).fail( (data) => {
                    alert('error'); //TODO Fake It
                })
            });
            $('#fromMeToggle, #toMeToggle').on('click', event => {
                var $this = $(event.currentTarget)
                $('#fromMe, #toMe').toggle()
            })
            $('#toMe').hide();
        });
    </script>
</div>>
</body>
</html>
